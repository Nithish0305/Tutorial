{% extends 'journal/base.html' %}

{% block content %}
<div class="history-container">
    <div id="particles-js"></div>
    
    <div class="history-content">
        <h2>Your Mood History</h2>
        
        <div class="search-form">
            <form method="get" action="{% url 'history' %}">
                <div class="form-group">
                    <label for="username">Enter Your Name:</label>
                    <input type="text" id="username" name="username" value="{{ username }}" required>
                    <button type="submit" class="btn">Search</button>
                </div>
            </form>
        </div>
        
        {% if username and entries %}
            <div class="history-list">
                {% for entry in entries %}
                <div class="history-item" data-mood="{{ entry.mood|lower }}">
                    <div class="history-date">
                        {{ entry.request_time|date:"F j, Y" }}<br>
                        <span>{{ entry.request_time|time:"g:i A" }}</span>
                    </div>
                    <div class="history-mood">
                        <h3>{{ entry.mood }}</h3>
                        <div class="history-quote">
                            <i class="fas fa-quote-left"></i>
                            <p>{{ entry.quote.quote }}</p>
                            <i class="fas fa-quote-right"></i>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% elif username %}
            <div class="no-entries">
                <p>No mood entries found for {{ username }}.</p>
                <a href="{% url 'index' %}" class="btn">Create Your First Entry</a>
            </div>
        {% endif %}
        
        {% if not username %}
            <div class="instructions">
                <p>Enter your name to view your mood history.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize particles.js
    function initParticles() {
        let particleConfig = {
            particles: {
                number: {
                    value: 50,
                    density: {
                        enable: true,
                        value_area: 800
                    }
                },
                color: {
                    value: "#ffffff"
                },
                shape: {
                    type: "circle",
                },
                opacity: {
                    value: 0.3,
                    random: false,
                },
                size: {
                    value: 3,
                    random: true,
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#ffffff",
                    opacity: 0.2,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1.5,
                    direction: "none",
                    random: false,
                    straight: false,
                    out_mode: "out",
                    bounce: false,
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: {
                        enable: true,
                        mode: "grab"
                    },
                    onclick: {
                        enable: true,
                        mode: "push"
                    },
                    resize: true
                },
                modes: {
                    grab: {
                        distance: 140,
                        line_linked: {
                            opacity: 1
                        }
                    },
                    push: {
                        particles_nb: 4
                    }
                }
            },
            retina_detect: true
        };
        
        particlesJS('particles-js', particleConfig);
    }
    
    $(document).ready(function() {
        initParticles();
        
        // Apply mood-specific colors to history items
        $('.history-item').each(function() {
            const mood = $(this).data('mood');
            let gradientColors = {};
            
            switch(mood) {
                case 'happy':
                    gradientColors = {
                        start: '#FFD700',
                        end: '#FFA500'
                    };
                    break;
                case 'sad':
                    gradientColors = {
                        start: '#6495ED',
                        end: '#4169E1'
                    };
                    break;
                case 'relax':
                    gradientColors = {
                        start: '#90EE90',
                        end: '#3CB371'
                    };
                    break;
                case 'energetic':
                    gradientColors = {
                        start: '#FF4500',
                        end: '#FF8C00'
                    };
                    break;
                case 'romantic':
                    gradientColors = {
                        start: '#FF69B4',
                        end: '#DA70D6'
                    };
                    break;
                case 'angry':
                    gradientColors = {
                        start: '#FF0000',
                        end: '#8B0000'
                    };
                    break;
                case 'chill':
                    gradientColors = {
                        start: '#00CED1',
                        end: '#5F9EA0'
                    };
                    break;
                case 'motivated':
                    gradientColors = {
                        start: '#FFA500',
                        end: '#FF6347'
                    };
                    break;
                case 'melancholy':
                    gradientColors = {
                        start: '#9370DB',
                        end: '#483D8B'
                    };
                    break;
                case 'excited':
                    gradientColors = {
                        start: '#FF1493',
                        end: '#FF69B4'
                    };
                    break;
                default:
                    gradientColors = {
                        start: '#3498db',
                        end: '#2c3e50'
                    };
            }
            
            $(this).css('background', `linear-gradient(135deg, ${gradientColors.start}, ${gradientColors.end})`);
        });
    });
</script>
{% endblock %}